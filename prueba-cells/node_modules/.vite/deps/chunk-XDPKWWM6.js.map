{
  "version": 3,
  "sources": ["../../@open-cells/element-controller/src/ElementController.js"],
  "sourcesContent": ["/*\n * Copyright 2024 Bilbao Vizcaya Argentaria, S.A.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { plugCellsCore } from '@open-cells/core-plugin';\nexport class ElementController {\n  constructor(host) {\n    this.subscriptions = [];\n    plugCellsCore(this);\n    this.subscribe = this.subscribe.bind(host);\n    this.unsubscribe = this.unsubscribe.bind(host);\n    this.publish = this.publish.bind(host);\n    (this.host = host).addController(this);\n    this._definedBoundedProperties();\n  }\n\n  _definedBoundedProperties() {\n    const inbounds = this.host.constructor.inbounds;\n    const outbounds = this.host.constructor.outbounds;\n\n    if (!inbounds && !outbounds) {\n      return;\n    }\n\n    const inout = this._mergeBounds(inbounds, outbounds);\n\n    Object.keys(inout).forEach(key => {\n      let { output, input, skipUpdate, action } = inout[key];\n      this._inOut(key, output, input, (skipUpdate = false), action);\n    });\n  }\n\n  _mergeBounds(inbounds = {}, outbounds = {}) {\n    const inout = [];\n    Object.keys(inbounds).forEach(key => {\n      const { channel: input, skipUpdate, action } = inbounds[key];\n      inout[key] = { input, skipUpdate, action };\n    });\n    Object.keys(outbounds).forEach(key => {\n      const { channel: output } = outbounds[key];\n      let previous = inout[key] || {};\n      inout[key] = { ...previous, output };\n    });\n    return inout;\n  }\n\n  _inOut(propertyName, outChannelName, inChannelName, skipUpdate = false, action) {\n    let internalValue;\n    let setter = value => {\n      internalValue = value;\n      this.publish(outChannelName, value);\n    };\n    let getter = () => {\n      return internalValue;\n    };\n\n    let internalSubscriberAction;\n    if (action && typeof action === 'function') {\n      internalSubscriberAction = value => {\n        internalValue = action(value);\n        if (!skipUpdate) {\n          this.host.requestUpdate();\n        }\n      };\n    } else {\n      internalSubscriberAction = value => {\n        internalValue = value;\n        if (!skipUpdate) {\n          this.host.requestUpdate();\n        }\n      };\n    }\n\n    this.subscriptions.push({ channel: inChannelName, action: internalSubscriberAction });\n    if (outChannelName) {\n      Object.defineProperties(this.host, {\n        [propertyName]: {\n          get: getter,\n          set: setter,\n        },\n      });\n    } else {\n      Object.defineProperties(this.host, {\n        [propertyName]: {\n          get: getter,\n        },\n      });\n    }\n  }\n\n  hostConnected() {\n    for (const subscription of this.subscriptions) {\n      this.subscribe(subscription.channel, subscription.action);\n    }\n  }\n\n  hostDisconnected() {\n    for (const subscription of this.subscriptions) {\n      this.unsubscribe(subscription.channel);\n    }\n  }\n}\n"],
  "mappings": ";;;;;AAiBO,IAAM,oBAAN,MAAwB;AAAA,EAC7B,YAAY,MAAM;AAChB,SAAK,gBAAgB,CAAC;AACtB,kBAAc,IAAI;AAClB,SAAK,YAAY,KAAK,UAAU,KAAK,IAAI;AACzC,SAAK,cAAc,KAAK,YAAY,KAAK,IAAI;AAC7C,SAAK,UAAU,KAAK,QAAQ,KAAK,IAAI;AACrC,KAAC,KAAK,OAAO,MAAM,cAAc,IAAI;AACrC,SAAK,0BAA0B;AAAA,EACjC;AAAA,EAEA,4BAA4B;AAC1B,UAAM,WAAW,KAAK,KAAK,YAAY;AACvC,UAAM,YAAY,KAAK,KAAK,YAAY;AAExC,QAAI,CAAC,YAAY,CAAC,WAAW;AAC3B;AAAA,IACF;AAEA,UAAM,QAAQ,KAAK,aAAa,UAAU,SAAS;AAEnD,WAAO,KAAK,KAAK,EAAE,QAAQ,SAAO;AAChC,UAAI,EAAE,QAAQ,OAAO,YAAY,OAAO,IAAI,MAAM,GAAG;AACrD,WAAK,OAAO,KAAK,QAAQ,OAAQ,aAAa,OAAQ,MAAM;AAAA,IAC9D,CAAC;AAAA,EACH;AAAA,EAEA,aAAa,WAAW,CAAC,GAAG,YAAY,CAAC,GAAG;AAC1C,UAAM,QAAQ,CAAC;AACf,WAAO,KAAK,QAAQ,EAAE,QAAQ,SAAO;AACnC,YAAM,EAAE,SAAS,OAAO,YAAY,OAAO,IAAI,SAAS,GAAG;AAC3D,YAAM,GAAG,IAAI,EAAE,OAAO,YAAY,OAAO;AAAA,IAC3C,CAAC;AACD,WAAO,KAAK,SAAS,EAAE,QAAQ,SAAO;AACpC,YAAM,EAAE,SAAS,OAAO,IAAI,UAAU,GAAG;AACzC,UAAI,WAAW,MAAM,GAAG,KAAK,CAAC;AAC9B,YAAM,GAAG,IAAI,EAAE,GAAG,UAAU,OAAO;AAAA,IACrC,CAAC;AACD,WAAO;AAAA,EACT;AAAA,EAEA,OAAO,cAAc,gBAAgB,eAAe,aAAa,OAAO,QAAQ;AAC9E,QAAI;AACJ,QAAI,SAAS,WAAS;AACpB,sBAAgB;AAChB,WAAK,QAAQ,gBAAgB,KAAK;AAAA,IACpC;AACA,QAAI,SAAS,MAAM;AACjB,aAAO;AAAA,IACT;AAEA,QAAI;AACJ,QAAI,UAAU,OAAO,WAAW,YAAY;AAC1C,iCAA2B,WAAS;AAClC,wBAAgB,OAAO,KAAK;AAC5B,YAAI,CAAC,YAAY;AACf,eAAK,KAAK,cAAc;AAAA,QAC1B;AAAA,MACF;AAAA,IACF,OAAO;AACL,iCAA2B,WAAS;AAClC,wBAAgB;AAChB,YAAI,CAAC,YAAY;AACf,eAAK,KAAK,cAAc;AAAA,QAC1B;AAAA,MACF;AAAA,IACF;AAEA,SAAK,cAAc,KAAK,EAAE,SAAS,eAAe,QAAQ,yBAAyB,CAAC;AACpF,QAAI,gBAAgB;AAClB,aAAO,iBAAiB,KAAK,MAAM;AAAA,QACjC,CAAC,YAAY,GAAG;AAAA,UACd,KAAK;AAAA,UACL,KAAK;AAAA,QACP;AAAA,MACF,CAAC;AAAA,IACH,OAAO;AACL,aAAO,iBAAiB,KAAK,MAAM;AAAA,QACjC,CAAC,YAAY,GAAG;AAAA,UACd,KAAK;AAAA,QACP;AAAA,MACF,CAAC;AAAA,IACH;AAAA,EACF;AAAA,EAEA,gBAAgB;AACd,eAAW,gBAAgB,KAAK,eAAe;AAC7C,WAAK,UAAU,aAAa,SAAS,aAAa,MAAM;AAAA,IAC1D;AAAA,EACF;AAAA,EAEA,mBAAmB;AACjB,eAAW,gBAAgB,KAAK,eAAe;AAC7C,WAAK,YAAY,aAAa,OAAO;AAAA,IACvC;AAAA,EACF;AACF;",
  "names": []
}
